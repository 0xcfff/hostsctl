###### URL
# @sync http://192.168.100.2/dns-records?domain=.sync-ops.com&domain=.sync-svc.com
# @unsafe true
# @interval auto

# @sync source=http://192.168.100.2/dns-records?domain=.sync-ops.com&domain=.sync-svc.com, unsafe=true, interval=auto

###### kubectl
# @sync kubectl
# @context microk8s
# @interval auto

# @sync kubectl
# @params context=microk8s, interval=auto

# @sync source=kubectl, context=microk8s, interval=auto

###### local file
# @sync /home/user1/temp_dns



###### sync block (output)

# @begin <config_hash>-<data_hash>
# @end <config_hash>-<data_hash>


## Parsers
https://github.com/alecthomas/participle/blob/master/_examples/sql/main.go


add function which detects line endings in the parsed file. If can't detect, use OS version

dom or syntax - this should contain low-level constructs
dom or model - one of these should contain high-level abstraction which could be serialized to syntax constructs

syntax - syntax tree, root - document, leaves - line-level objects (parse + parse options/write) - invisible to end user
model - model based on syntax tree - hosts document and nested blocks (construct/generate markup or format + generate options). 
This level objects should understand such things as whether IP is a system and its deletion can bring an issue.

generation modes:
* minimal intrusion - as close to the source as possible
* re-format - re-format entire document according to generate options
use strategies (pattern) to switch between generation modes


#####################################
# cmdline

dnspipe version
dnspipe hosts source list
dnspipe hosts source add
dnspipe hosts source query
dnspipe hosts ip list
dnspipe hosts ip add
dnspipe hosts sync --watch
dnspipe source list
dnspipe source add
dnspipe source query
dnspipe dns hijack
dnspipe dns proxy
dnspipe dns restore
dnspipe serve [src] [tgt] [profile]

#####################################
# cmdline - updated concept

hostsctl version
hostsctl ip list 
hostsctl ip add [ip] [dns] --group [group_id]
hostsctl ip edit
hostsctl ip delete [ip or dns]
hostsctl block list
hostsctl block add [id?] [text]
hostsctl block edit
hostsctl block delete
hostsctl block clean [id or index] - removes all IPs in the block
hostsctl config print
hostsctl config format
hostsctl config edit
hostsctl config backup
hostsctl config restore


hostsctl version
hostsctl get ip [filters]
hostsctl get block [filters]
hostsctl add ip
hostsctl add ip -- [params opt multiline]
hostsctl add block
hostsctl delete ip [filters]
hostsctl delete block [filters]
hostsctl edit ip
hostsctl edit block
hostsctl edit config
hostsctl show config
hostsctl show location

hostsctl !192.168.1.2 my.domain.test
hostsctl +192.168.1.2 my.domain.test
hostsctl -192.168.1.2
hostsctl -my.domain.test

hostsctl -192.168.1.2 +192.168.1.2 my.domain.test


##################
TODO
add ParseFlags to EtcHosts parsing logic





